{% extends "admin/base.html" %}

{% block title %}Device Types{% endblock %}
{% block header %}
<style>
    .dot {
        height: 25px;
        width: 25px;
        background-color: #bbb;
        border-radius: 50%;
        display: inline-block;
    }
</style>
{% endblock %}

{% block content %}
 <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
    <h1 class="h2">Device Types</h1>

    <button type="button" class="btn btn-secondary new-btn"
    style="padding-top: 0px;padding-bottom: 2px;padding-right: 5px;padding-left: 5px">
    New <span data-feather="plus-circle"></span>
    </button>
  </div>

    <div class="modal fade" id="deviceTypeModal" tabindex="-1" role="dialog" aria-labelledby="deviceTypeModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="deviceTypeModalLabel"></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <input type="hidden" class="form-control" id="device_type_func">
              <input type="hidden" class="form-control" id="device_type_id">
              <div class="form-group">
                <label for="device_type_name" class="col-form-label">Device type name:</label>
                <input type="text" class="form-control" id="device_type_name">
              </div>
              <div class="form-group">
                <label for="device_type_description" class="col-form-label">Description:</label>
                <textarea class="form-control" id="device_type_description"></textarea>
              </div>
              <div class="form-group">
                <label for="device_type_allowed_time" class="col-form-label">Allowed time (in seconds):</label>
                <input type="number" class="form-control" id="device_type_allowed_time">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" id="device_type_update_button">Save</button>
          </div>
        </div>
      </div>
    </div>
    <table class="table table-striped table-sm">
        <thead>
            <tr>
            <th>#</th>
            <th>Name</th>
            <th>Description</th>
            <th>Allowed time</th>
            <th style="text-align: center;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for device_type in device_types %}
                <td id="item_device_type_id">{{device_type.id}}</td>
                <td id="item_device_type_name">{{device_type.name}}</td>
                <td id="item_device_type_desc">{{device_type.description}}</td>
                <td id="item_device_type_allowed_time">{{device_type.allowed_time}}</td>
                <td style="text-align: center;">
                    <div>
                        <button type="button" class="btn btn-secondary edit-btn"
                            style="padding-top: 0px;padding-bottom: 2px;padding-right: 5px;padding-left: 5px">
                            <span data-feather="edit"></span>
                        </button>
                        <button type="button" class="btn btn-secondary delete-btn"
                            style="padding-top: 0px;padding-bottom: 2px;padding-right: 5px;padding-left: 5px">
                            <span data-feather="trash"></span>
                        </button>
                    </div>
                </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function() {
        function update() {
            var func = $( "#device_type_func" ).val();
            var id = $( "#device_type_id" ).val();
            var name = $( "#device_type_name" ).val();
            var description = $( "#device_type_description" ).val();
            var allowed_time = $( "#device_type_allowed_time" ).val();

            if (id == null || id == "") {
                id = 0;
            }

            $.ajax({
                type: func,
                url: 'device_types',
                data: {"id": id, "name": name, "description": description, "allowed_time": allowed_time},
                success: function(data)
                {
                    location.reload();
                },
                error: function(jqXHR, textStatus, errorThrown)
                {
                    alert(jqXHR.responseText);
                }

            });
        }

        $("#device_type_update_button").click(update);

        $( ".new-btn" ).click(function() {

            $("#deviceTypeModalLabel").html("Add new device type");
            $("#device_type_func").val("PUT");
            $("#device_type_id").val("");
            $("#device_type_name").val("");
            $("#device_type_description").val("");
            $("#device_type_allowed_time").val("");

            $('#deviceTypeModal').modal('show');

        });
        $( ".edit-btn" ).click(function() {
            // Each individual row
            var row_obj = $( this ).parent().parent().parent();

            $("#deviceTypeModalLabel").html("Edit device type");
            $("#device_type_func").val("PATCH");
            $("#device_type_id").val($( "#item_device_type_id", row_obj ).html());
            $("#device_type_name").val($( "#item_device_type_name", row_obj ).html());
            $("#device_type_description").val($( "#item_device_type_desc", row_obj ).html());
            $("#device_type_allowed_time").val($( "#item_device_type_allowed_time", row_obj ).html());

            $('#deviceTypeModal').modal('show');
        });
        $( ".delete-btn" ).click(function() {
            // Each individual row
            var row_obj = $( this ).parent().parent().parent();

            var id = $( "#item_device_type_id", row_obj ).html();

            $.ajax({
                type: "DELETE",
                url: 'device_types',
                data: {"id": id},
                success: function(data)
                {
                    location.reload();
                },
                error: function(jqXHR, textStatus, errorThrown)
                {
                    alert(jqXHR.responseText);
                }

            });
        });

    });
</script>
{% endblock %}
